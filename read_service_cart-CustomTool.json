{
  "name": "read_service_cart",
  "description": "Lee el estado actual del carrito de servicios del usuario para mantener contexto",
  "color": "linear-gradient(rgb(34,112,209), rgb(137,126,63))",
  "iconSrc": null,
  "schema": "[{\"property\":\"conversation_id\",\"type\":\"string\",\"description\":\"ID de la conversación actual para identificar el carrito\",\"required\":true}]",
  "func": "/*\n* Casalimpia Custom Tool: read_service_cart\n* Lee el estado actual del carrito de servicios del usuario\n* Variable: $conversation_id\n*/\n\nconst readServiceCart = async () => {\n  try {\n    const conversationId = $conversation_id || $flow.sessionId;\n    \n    // Si usas API externa de Casalimpia\n    if (process.env.CASALIMPIA_API_BASE && process.env.CASALIMPIA_API_TOKEN) {\n      const response = await fetch(`${process.env.CASALIMPIA_API_BASE}/cart/${conversationId}`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${process.env.CASALIMPIA_API_TOKEN}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      \n      if (!response.ok) {\n        return JSON.stringify({ \n          cart_items: [], \n          user_city: \"\", \n          total_items: 0,\n          message: \"Carrito vacío\" \n        });\n      }\n      \n      const cartData = await response.json();\n      return JSON.stringify(cartData);\n    }\n    \n    // Alternativa: usar Flow State como carrito temporal\n    const cartState = $flow.state?.cart_items || [];\n    const userCity = $flow.state?.user_city || \"\";\n    \n    return JSON.stringify({\n      cart_items: cartState,\n      user_city: userCity,\n      total_items: cartState.length,\n      conversation_id: conversationId,\n      message: cartState.length > 0 ? `Tienes ${cartState.length} servicio(s) en el carrito` : \"Carrito vacío\"\n    });\n    \n  } catch (error) {\n    console.error('Error reading cart:', error);\n    return JSON.stringify({ \n      error: 'Failed to read cart', \n      cart_items: [], \n      user_city: \"\",\n      total_items: 0,\n      message: 'Error al leer el carrito'\n    });\n  }\n};\n\nconst result = await readServiceCart();\nreturn result;",
  "workspaceId": "3d76328e-d825-4824-92e0-dc840f47a68a"
}